# Образовательное учреждение: Управление Расписанием, Успеваемостью и Документами

Это клиент-серверное приложение предназначено для управления учебным процессом в образовательном учреждении. Оно предоставляет разграниченный доступ для студентов и администраторов к функциям просмотра и управления академической информацией.

## Содержание

1.  [Технологический стек](#технологический-стек)
2.  [Структура проекта](#структура-проекта)
3.  [Роли пользователей](#роли-пользователей)
4.  [Требования для запуска](#требования-для-запуска)
5.  [Настройка и запуск](#настройка-и-запуск)
    *   [База данных (PostgreSQL)](#база-данных-postgresql)
    *   [Серверная часть (Java)](#серверная-часть-java)
    *   [Клиентская часть (HTML/JS/CSS)](#клиентская-часть-htmljscss)
    *   [Автоматический запуск (PowerShell скрипт)](#автоматический-запуск-powershell-скрипт)
6.  [Архитектура](#архитектура)
7.  [REST API Эндпоинты](#rest-api-эндпоинты)
8.  [Описание файлов проекта](#описание-файлов-проекта)
    *   [Серверная часть (Java)](#серверная-часть-java-1)
    *   [Клиентская часть (JS/HTML/CSS)](#клиентская-часть-jshtmlcss-1)
9.  [Дальнейшее развитие](#дальнейшее-развитие)

## 1. Технологический стек

*   **Серверная часть:**
    *   Язык: Java (JDK 21)
    *   Фреймворк: SparkJava (для REST API)
    *   База данных: PostgreSQL
    *   Сборка: Maven
    *   Работа с JSON: Jackson
    *   Логирование: SLF4J + Logback
    *   Аутентификация: JWT (библиотека JJWT)
    *   Хеширование паролей: BCrypt (jBCrypt)
    *   Пул соединений с БД: HikariCP
*   **Клиентская часть:**
    *   HTML5
    *   CSS3
    *   JavaScript (ES6+)
    *   Взаимодействие с API: Fetch API
    *   Хранение сессии: `localStorage`
*   **Инструменты:**
    *   Среда разработки: IntelliJ IDEA Community Edition
    *   Система контроля версий: Git / GitHub
    *   (Для запуска клиента) Node.js и `http-server` (опционально)

## 2. Структура проекта

Проект разделен на две основные независимые части: серверную и клиентскую.
```dtd
rest-api-java-js/
├── server/ # Серверная часть (Maven проект)
│ ├── pom.xml
│ └── src/
│ └── main/
│ ├── java/com/example/education/ # Исходный код Java
│ │ ├── App.java
│ │ ├── config/
│ │ ├── controller/
│ │ ├── dao/
│ │ ├── filter/
│ │ ├── model/
│ │ ├── service/
│ │ └── util/
│ └── resources/
│ ├── server.properties
│ ├── logback.xml
│ └── db_schema.sql
├── client/ # Клиентская часть (статичные файлы)
│ ├── index.html
│ ├── favicon.ico # Иконка вкладки
│ ├── css/style.css
│ └── js/
│ ├── app.js
│ ├── config.js
│ ├── apiService.js
│ ├── auth.js
│ ├── router.js
│ ├── views/ # loginView.js, studentsView.js и тд.
│ └── controllers/ # authController.js, studentsController.js и тд.
├── .gitignore
├── README.md
└── start-dev-env.ps1 # Скрипт для запуска окружения (Windows PowerShell)
```


## 3. Роли пользователей

*   **Студент:**
    *   Может регистрироваться и входить в систему.
    *   Просматривать свой профиль и редактировать ограниченный набор данных.
    *   Просматривать список всех курсов.
    *   Записываться на курсы и отписываться от своих записей.
    *   Просматривать свои оценки по всем курсам и по конкретной записи на курс.
    *   Загружать, просматривать, скачивать и удалять свои документы.
*   **Администратор (`EMPLOYEE` с ролью `ADMIN`):**
    *   Может входить в систему.
    *   Имеет доступ ко всем функциям управления студентами (CRUD, просмотр записей, оценок, документов).
    *   Имеет доступ ко всем функциям управления курсами (CRUD, просмотр студентов на курсе).
    *   Может управлять записями студентов на курсы (записывать, отписывать).
    *   Может управлять оценками студентов (добавлять, редактировать, удалять).
    *   Может управлять документами студентов (загружать от имени, просматривать, скачивать, удалять).

## 4. Требования для запуска

*   Java Development Kit (JDK) 11 или выше.
*   Apache Maven 3.6.0 или выше.
*   PostgreSQL сервер (версия 10+ рекомендуется).
*   Веб-браузер (Chrome, Firefox, Edge).
*   Для запуска скрипта `start-dev-env.ps1` на Windows: PowerShell.
*   (Опционально для `start-dev-env.ps1` или ручного запуска клиента) Node.js и npm (для `npx http-server`).

## 5. Настройка и запуск

### База данных (PostgreSQL)

1.  **Установите и запустите PostgreSQL.**
2.  **Создайте пользователя и базу данных:** Используйте `psql` или pgAdmin. Примерные данные (замените на свои): пользователь `your_user`, пароль `your_password`, база данных `education_db`. Предоставьте пользователю все привилегии на эту БД.
3.  **Создайте таблицы:** Подключитесь к созданной БД и выполните SQL-скрипт `server/src/main/resources/db_schema.sql`. Этот скрипт создаст все необходимые таблицы, а также пример администратора (не забудьте заменить плейсхолдер хеша пароля на актуальный).

### Серверная часть (Java)

1.  **Настройте `server.properties`:** В `server/src/main/resources/server.properties` укажите корректные данные для БД и JWT.
2.  **Соберите проект:** В директории `server/` выполните `mvn clean package`.
3.  **Запустите сервер:** В той же директории `java -jar target/rest-api-java-js-1.0-SNAPSHOT.jar`.

### Клиентская часть (HTML/JS/CSS)

1.  **Настройте `config.js`:** В `client/js/config.js` убедитесь, что `clientConfig.serverUrl` указывает на ваш запущенный Java-сервер.
2.  **Запустите клиент:**
    *   **Простой способ:** Откройте `client/index.html` в браузере.
    *   **С помощью http-server (рекомендуется):** В директории `client/` выполните `npx http-server -p 8001 -c-1 --cors` (порт 8001 или другой). Откройте `http://localhost:8001` в браузере.

### Автоматический запуск (PowerShell скрипт)

Для автоматического запуска сервера и клиента (с `http-server`) на Windows можно использовать скрипт `start-dev-env.ps1`.

1.  **Убедитесь, что Node.js и npm установлены** (для `npx http-server`).
2.  **Настройте политику выполнения PowerShell:**
    *   Откройте PowerShell от имени администратора.
    *   Выполните: `Set-ExecutionPolicy RemoteSigned` (и подтвердите `Y` или `A`).
3.  **Запустите скрипт:**
    *   Откройте PowerShell в корневой папке проекта (`rest-api-java-js/`).
    *   Выполните: `.\start-dev-env.ps1`
        Скрипт попытается собрать сервер (если нужно), запустит Java-сервер, затем `http-server` для клиента, и откроет клиент в браузере. Серверы будут запущены в отдельных окнах PowerShell.

## 6. Архитектура

*   **Сервер:** MVC-подобная, сервисный слой, DAO, JWT-аутентификация, фильтры.
*   **Клиент:** SPA, MVC-подобная структура (ApiService/Auth как Model, Views для отображения, Controllers для логики UI), хеш-роутинг.

## 7. REST API Эндпоинты (Ключевые)

**Базовый URL:** `http://{хост_сервера}:{порт_сервера}/api`

*   **Аутентификация (`/auth`):**
    *   `POST /login`: Вход (студент/сотрудник), возвращает JWT и данные пользователя.
*   **Студенты (`/students`):**
    *   `POST /`: Регистрация студента (публичный).
    *   `GET /`: Список всех студентов (Админ).
    *   `GET /{id}`: Студент по ID (Админ, сам студент).
    *   `PUT /{id}`: Обновление студента (Админ, сам студент - свой профиль с ограничениями).
    *   `DELETE /{id}`: Удаление студента (Админ).
*   **Курсы (`/courses`):**
    *   `POST /`: Создание курса (Админ).
    *   `GET /`: Список всех курсов (Все аутентифицированные).
    *   `GET /{id}`: Курс по ID (Все аутентифицированные).
    *   `PUT /{id}`: Обновление курса (Админ).
    *   `DELETE /{id}`: Удаление курса (Админ).
*   **Записи на курсы (`/enrollments`, `/students/{id}/enrollments`, `/courses/{id}/enrollments`):**
    *   `POST /enrollments`: Запись на курс (Админ, сам студент).
    *   `GET /enrollments`: Все записи (Админ).
    *   `DELETE /enrollments/{id}`: Отмена записи (Админ, сам студент - свою).
    *   И другие для получения записей по студенту/курсу.
*   **Оценки (`/grades`, `/enrollments/{id}/grades`, `/students/{id}/grades`):**
    *   `POST /grades`: Добавление оценки (Админ).
    *   `GET /grades/{id}`: Оценка по ID (Админ, сам студент - свою).
    *   `PUT /grades/{id}`: Обновление оценки (Админ).
    *   `DELETE /grades/{id}`: Удаление оценки (Админ).
    *   И другие для получения оценок по записи/студенту.
*   **Документы (`/documents`, `/students/{id}/documents`):**
    *   `POST /students/{studentId}/documents/upload`: Загрузка документа (Админ, сам студент - свой).
    *   `GET /documents/{id}/download`: Скачивание файла.
    *   CRUD операции для метаданных документов с проверкой прав.

(Для полного списка см. код контроллеров)

## 8. Описание файлов проекта

### Серверная часть (Java)
*   **`App.java`**: Точка входа, настройка SparkJava, маршрутов, фильтров.
*   **`model/*.java`**: POJO (Student, Employee, Course, Grade, Document, StudentCourse), Enum (UserType), вспомогательные (Session, UserCredentials).
*   **`dao/*.java`**: Классы доступа к данным (StudentDao, EmployeeDao, etc.), DatabaseManager.
*   **`service/*.java`**: Бизнес-логика (AuthService, StudentService, etc.).
*   **`controller/*.java`**: Обработчики HTTP-запросов REST API.
*   **`filter/AuthenticationFilter.java`**: Проверка JWT-токенов.
*   **`util/*.java`**: Вспомогательные классы (JsonUtil, JwtUtil, PasswordUtil).
*   **`resources/`**: Конфигурационные файлы (server.properties, logback.xml) и схема БД (db_schema.sql).

### Клиентская часть (JS/HTML/CSS)
*   **`index.html`**: Основной HTML-каркас SPA.
*   **`css/style.css`**: Стили оформления.
*   **`js/config.js`**: URL сервера и другие настройки клиента.
*   **`js/apiService.js`**: Модуль для всех AJAX-запросов к API сервера.
*   **`js/auth.js`**: Управление аутентификацией, токеном, информацией о пользователе, навигацией.
*   **`js/router.js`**: Клиентский хеш-роутер.
*   **`js/views/*.js`**: Объекты с функциями рендеринга HTML для различных представлений.
*   **`js/controllers/*.js`**: Объекты с логикой для каждой "страницы", обработчики событий.
*   **`js/app.js`**: Инициализация клиентского приложения, регистрация маршрутов.
